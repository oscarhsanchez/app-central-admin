<div class="margin-b">
    <a class="btn btn-white" title="{{ 'medio.buttons.add'|trans }}" onclick="loadAjaxFormPage(this, 'modal-lg', null, medio_list_reload); return false;" href="{{ path('medio_add', { ubicacion: entity.pkUbicacion }) }}">
        <span class="glyphicon glyphicon-plus"></span>
        <strong>{{ 'medio.buttons.add'|trans }}</strong>
    </a>
</div>
<table id="dt-medio-list" class="table table-striped table-bordered table-hover">
    <thead>
    <tr>
        <th class="datatable-chk-cell"><input type="checkbox" class="i-checks datatable-chk-select-all" value="all" /></th>
        <th>{{ 'form.medio.label.pk_medio'|trans }}</th>
        <th>{{ 'form.medio.label.ubicacion'|trans }}</th>
        <th>{{ 'form.medio.label.posicion'|trans }}</th>
        <th>{{ 'form.medio.label.id_cara'|trans }}</th>
        <th>{{ 'form.medio.label.tipo_medio'|trans }}</th>
        <th>{{ 'form.medio.label.subtipo_medio'|trans }}</th>
        <th>{{ 'form.medio.label.estado'|trans }}</th>
        <th>{{ 'form.label.actions'|trans }}</th>
    </tr>
    </thead>
</table>

<script type="text/javascript">
    var medio_list = null;
    $(document).ready(function() {
        var table_columns = [
            {
                "mData": function (source) {
                    return '<input type="checkbox" class="i-checks" value="'+source.token+'" />';
                }
            },
            {"mData": "pk_medio"},
            {"mData": "ubicacion__ubicacion"},
            {"mData": "posicion"},
            {"mData": "id_cara"},
            {"mData": "tipo_medio"},
            {"mData": "subtipoMedio__descripcion"},
            {
                "mData": function (source){
                    return source.estado ? '<span class="glyphicon glyphicon-ok"></span>' : '';
                }
            },
            {
                "mData": function (source){
                    var actions = '<a class="btn btn-primary btn-xs" title="{{ 'medio.buttons.edit'|trans }}" onclick="loadAjaxFormPage(this, \'modal-lg\', null, medio_list_reload); return false;" href="' + Routing.generate('medio_edit', { _locale: '{{ app.request.locale }}', id: encodeURIComponent(source.token) }) + '"><span class="glyphicon glyphicon-edit"></span> &nbsp; {{ 'form.actions.edit'|trans }}</a>&nbsp; ';
                    actions += '<a class="btn btn-primary btn-xs" title="{{ 'medio.buttons.availability'|trans }}" onclick="loadAjaxPage(this, \'modal-lg\', null, null); return false;" href="' + Routing.generate('medio_availability', { _locale: '{{ app.request.locale }}', id: encodeURIComponent(source.token) }) + '"><span class="glyphicon glyphicon-edit"></span> &nbsp; {{ 'form.actions.view_availability'|trans }}</a>&nbsp; ';
                    actions += '<a class="btn btn-primary btn-xs" href="javascript:void(0)" onclick="bootbox.confirm(\'Seguro que desea eliminar el registro?\', function(confirmed){ if(confirmed) executeAjax(\'' + Routing.generate('medio_delete', { _locale: '{{ app.request.locale }}', id: encodeURIComponent(source.token) }) + '\', null, null, medio_list_reload); }); return false;"><span class="glyphicon glyphicon-remove"></span> &nbsp; {{ 'form.actions.delete'|trans }}</a>&nbsp; ';
                    return actions;
                }
            }
        ];

        medio_list = TableManaged.init(
                '#dt-medio-list',
                '{{ url('medio_list_json', { ubicacion: entity.pkUbicacion }) }}',
                null,
                [],
                table_columns,
                '{{ url('datatables_i18n_fragment', { language: app.request.locale }) }}'
        );
    });

    function medio_list_reload(result){
        if (result && result.message){
            var alertType = result.result == 1 ? 'success' : 'danger';
            $(medio_list).closest('.dataTables_wrapper').prepend(Notification.alert(alertType, result.message));
        }
        medio_list.ajax.reload();
    }

    function selectSubtipoMedio(data, vars){
        var jsonData = decodeURIComponent(data);
        var obj = JSON.parse(jsonData);
        var objVars = JSON.parse(vars);
        $("#medio_subtipoMedio").val(obj.token);
        $("#select-input-group-medio_subtipoMedio").html(obj.descripcion);
    }
</script>